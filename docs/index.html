<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7c3aed">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Soul Reflections</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg, #f0e7ff 0%, #ffffff 100%);
      color: #4a4a4a;
      text-align: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }
    .header {
      display: flex;
      justify-content: space-between;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(5px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    .content {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 30px 20px;
    }
    .prompt, h2, p {
      margin: 12px 0;
    }
    h2 {
      font-size: 1.8rem;
      font-weight: 400;
      color: #6b4e9a;
      letter-spacing: 0.5px;
    }
    .prompt {
      font-size: 1.2rem;
      font-style: italic;
      color: #5c5c5c;
    }
    p {
      font-size: 1rem;
      color: #666;
    }
    .button {
      background: linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%);
      color: #fff;
      border: none;
      padding: 8px 18px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 0.85rem;
      font-family: 'Georgia', serif;
      font-weight: 400;
      letter-spacing: 1px;
      text-transform: none;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease-in-out;
    }
    .button:hover {
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.2);
      transform: translateY(-2px);
    }
    .button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .button:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
    }
    .floating-plus {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease-in-out;
    }
    .floating-plus:hover {
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);
      transform: translateY(-2px);
    }
    .hidden { display: none; }
    input[type="text"], textarea {
      width: 85%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      margin: 12px 0;
      font-family: 'Georgia', serif;
      background: rgba(255, 255, 255, 0.95);
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    textarea { min-height: 120px; resize: vertical; }
    #history-list { width: 90%; }
    .history-item {
      text-align: left;
      padding: 15px;
      background: rgba(255, 255, 255, 0.95);
      margin: 8px 0;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      cursor: pointer;
    }
    .history-item img {
      max-width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
    .history-item button {
      margin: 3px;
      padding: 6px 12px;
      font-size: 0.8rem;
      border-radius: 20px;
      background: linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease-in-out;
    }
    .history-item button:hover {
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      transform: translateY(-1px);
    }
    img.preview {
      max-width: 85%;
      margin-top: 12px;
      display: none;
      border-radius: 10px;
    }
    #current-date {
      font-size: 1rem;
      font-weight: 400;
      color: #6b4e9a;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }
    #current-time {
      font-size: 0.85rem;
      font-weight: 300;
      color: #7c7c7c;
      letter-spacing: 0.5px;
    }
    .button-group {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 12px 0;
    }
  </style>
</head>
<body>
  <div class="header">
    <span id="current-time"></span>
  </div>  

  <!-- Main Screen -->
  <div id="main-screen" class="content">
    <div id="quote" class="prompt">The wound is the place where the light enters you. – Rumi</div>
    <button class="button" onclick="newQuote()">Inspire Me</button>
    <h2>My Spiritual Journey...</h2>
    <p>Tap the plus button to begin writing your experience</p>
    <div class="button-group">
      <button class="button" onclick="showHistory()">Past Reflections</button>
    </div>
  </div>

  <!-- Entry Screen -->
  <div id="entry-screen" class="content hidden">
    <h2 id="current-date"></h2>
    <div id="reflection-question" class="prompt">What moment today felt like a gift from the universe?</div>
    <button class="button" onclick="newQuestion()">New Question</button>
    <input type="text" id="title" placeholder="Title">
    <textarea id="reflection" placeholder="Speak or type your reflections..."></textarea>
    <div>
      <input type="file" accept="image/*" id="image-input" capture="environment">
      <img id="preview-image" class="preview" src="" alt="Preview">
    </div>
    <div class="button-group">
      <button class="button" id="start-voice">Start Speaking</button>
      <button class="button" id="stop-voice" disabled>Stop Speaking</button>
      <button class="button" id="save" disabled>Save Reflection</button>
      <button class="button" onclick="goBack()">Back</button>
    </div>
  </div>

  <!-- History Screen -->
  <div id="history-screen" class="content hidden">
    <h2>Past Reflections</h2>
    <div id="history-list"></div>
    <div class="button-group">
      <button class="button" onclick="goBack()">Back</button>
    </div>
  </div>

  <div class="floating-plus" onclick="showEntryScreen()">+</div>

  <script>
    let recognition;
    let reflections = [];
    let currentImage = "";
    let editingIndex = null;

    const quotes = [
      "The wound is the place where the light enters you. – Rumi",
      "We should write because humans are spiritual beings and writing is a powerful form of prayer and meditation. – Gloria Anzaldúa",
      "Fill your paper with the breathings of your heart. – William Wordsworth",
      "There is no way to happiness—happiness is the way. – Thich Nhat Hanh",
      "The present moment is filled with joy and happiness. If you are attentive, you will see it. – Thich Nhat Hanh",
      "Breathing in, I calm my body. Breathing out, I smile. Dwelling in the present moment, I know this is a wonderful moment. – Thich Nhat Hanh",
      "You do not need to know precisely what is happening, or exactly where it is all going. What you need is to recognize the possibilities and challenges offered by the present moment, and to embrace them with courage, faith, and hope. – Thomas Merton",
      "Happiness is not a matter of intensity but of balance, order, rhythm and harmony. – Thomas Merton",
      "Compassion is a verb. – Thich Nhat Hanh",
      "When another person makes you suffer, it is because he suffers deeply within himself. He does not need punishment; he needs help. – Thich Nhat Hanh",
      "Understanding is love’s other name. If you don’t understand, you cannot love. – Thich Nhat Hanh",
      "Love is our true destiny. We do not find the meaning of life by ourselves alone—we find it with another. – Thomas Merton",
      "The biggest human temptation is to settle for too little love. – Thomas Merton",
      "Our job is to love others without stopping to inquire whether or not they are worthy. – Thomas Merton",
      "Sometimes your joy is the source of your smile, but sometimes your smile can be the source of your joy. – Thich Nhat Hanh",
      "Walk as if you are kissing the Earth with your feet. – Thich Nhat Hanh",
      "Because you are alive, everything is possible. – Thich Nhat Hanh",
      "We are not at peace because we have not yet learned to be alone with ourselves. – Thomas Merton",
      "Silence is the language of God, all else is poor translation. – Thomas Merton",
      "The things we fear most in prayer are the things that can save us. – Thomas Merton"
    ];

    const journalQuestions = [
      "What moment today felt like a gift from the universe?",
      "How did you find peace in a challenging situation?",
      "What inspires your soul to create today?",
      "What is one thing you’re grateful for right now?",
      "What vision for your future feels most alive?"
    ];

    function getRandomQuestion() {
      return journalQuestions[Math.floor(Math.random() * journalQuestions.length)];
    }

    function newQuote() {
      document.getElementById('quote').textContent =
        quotes[Math.floor(Math.random() * quotes.length)];
    }

    function newQuestion() {
      document.getElementById('reflection-question').textContent = getRandomQuestion();
    }

    function updateDateTime() {
      const now = new Date();
      const options = {
        weekday: 'long', month: 'short', day: 'numeric',
        year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true
      };
      document.getElementById('current-date').textContent =
        now.toLocaleString('en-US', options).replace(',', '');
      document.getElementById('current-time').textContent =
        now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }) + ' CDT';
    }

    function loadReflections() {
      const saved = localStorage.getItem('reflections');
      if (saved) {
        reflections = JSON.parse(saved);
      }
    }

    function saveReflections() {
      localStorage.setItem('reflections', JSON.stringify(reflections));
    }

    function showEntryScreen(index = null) {
      document.getElementById('main-screen').classList.add('hidden');
      document.getElementById('entry-screen').classList.remove('hidden');
      document.getElementById('history-screen').classList.add('hidden');
      document.getElementById('title').value = '';
      document.getElementById('reflection').value = '';
      document.getElementById('image-input').value = '';
      document.getElementById('preview-image').src = '';
      document.getElementById('preview-image').style.display = 'none';
      currentImage = "";
      editingIndex = index;
      if (index !== null && reflections[index]) {
        document.getElementById('title').value = reflections[index].title;
        document.getElementById('reflection').value = reflections[index].reflection;
        if (reflections[index].image) {
          document.getElementById('preview-image').src = reflections[index].image;
          document.getElementById('preview-image').style.display = 'block';
          currentImage = reflections[index].image;
        }
      }
      document.getElementById('save').disabled = !canSave();
      document.getElementById('start-voice').disabled = false;
      document.getElementById('stop-voice').disabled = true;
      newQuestion();
      updateDateTime();
    }

    function goBack() {
      if (recognition) recognition.stop();
      document.getElementById('entry-screen').classList.add('hidden');
      document.getElementById('history-screen').classList.add('hidden');
      document.getElementById('main-screen').classList.remove('hidden');
      editingIndex = null;
    }

    function showHistory() {
      document.getElementById('main-screen').classList.add('hidden');
      document.getElementById('entry-screen').classList.add('hidden');
      document.getElementById('history-screen').classList.remove('hidden');

      const list = document.getElementById('history-list');
      list.innerHTML = '';
      reflections.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <h3>${item.title}</h3>
          <p>${item.reflection}</p>
          <small>${item.date}</small>
          ${item.image ? `<img src="${item.image}">` : ""}
          <div class="button-group">
            <button class="button" onclick="editReflection(${index})">Edit</button>
            <button class="button" onclick="reviewReflection(${index})">Review</button>
            <button class="button" onclick="deleteReflection(${index})">Delete</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    function editReflection(index) {
      showEntryScreen(index);
    }

    function reviewReflection(index) {
      alert(`Title: ${reflections[index].title}\n\nReflection: ${reflections[index].reflection}\n\nDate: ${reflections[index].date}`);
    }

    function deleteReflection(index) {
      if (confirm('Are you sure you want to delete this reflection?')) {
        reflections.splice(index, 1);
        saveReflections();
        showHistory();
      }
    }

    function startVoiceRecognition() {
      if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
        alert('Speech recognition is not supported in your browser. Use Chrome.');
        return;
      }
      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'en-US';
      recognition.interimResults = true;
      recognition.continuous = true;

      recognition.onresult = (event) => {
        for (let i = event.resultIndex; i < event.results.length; i++) {
          const res = event.results[i];
          const chunk = res[0].transcript;
          if (res.isFinal) {
            appendSmartSentence(chunk);
          }
        }
        checkSaveEnabled();
      };

      recognition.onend = () => {
        document.getElementById('start-voice').disabled = false;
        document.getElementById('stop-voice').disabled = true;
      };

      recognition.onerror = () => {
        document.getElementById('start-voice').disabled = false;
        document.getElementById('stop-voice').disabled = true;
      };

      recognition.start();
      document.getElementById('start-voice').disabled = true;
      document.getElementById('stop-voice').disabled = false;
    }

    function stopVoiceRecognition() {
      if (recognition) recognition.stop();
    }

    function appendSmartSentence(text) {
      const box = document.getElementById('reflection');
      let t = (text || '').trim();
      if (!t) return;

      t = t.replace(/\s+/g, ' ');
      t = t.charAt(0).toUpperCase() + t.slice(1);
      if (!/[.!?…]$/.test(t)) {
        t += '.';
      }
      t += ' ';
      const existing = box.value;
      const needsSpace = existing && !/\s$/.test(existing);
      box.value = existing + (needsSpace ? ' ' : '') + t;
      box.selectionStart = box.selectionEnd = box.value.length;
    }

    function checkSaveEnabled() {
      document.getElementById('save').disabled = !canSave();
    }

    function canSave() {
      const title = document.getElementById('title').value.trim();
      const reflection = document.getElementById('reflection').value.trim();
      return !!(title && reflection);
    }

    function saveReflection() {
      const title = document.getElementById('title').value.trim();
      const reflection = document.getElementById('reflection').value.trim();
      const date = document.getElementById('current-date').textContent;

      if (editingIndex !== null) {
        reflections[editingIndex] = { title, reflection, date, image: currentImage };
      } else {
        reflections.push({ title, reflection, date, image: currentImage });
      }
      saveReflections();
      currentImage = "";
      editingIndex = null;
      goBack();
      alert("Reflection saved!");
    }

    function previewImage(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const preview = document.getElementById('preview-image');
          preview.src = e.target.result;
          preview.style.display = 'block';
          currentImage = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    }

    document.getElementById('start-voice').addEventListener('click', startVoiceRecognition);
    document.getElementById('stop-voice').addEventListener('click', stopVoiceRecognition);
    document.getElementById('title').addEventListener('input', checkSaveEnabled);
    document.getElementById('reflection').addEventListener('input', checkSaveEnabled);
    document.getElementById('save').addEventListener('click', saveReflection);
    document.getElementById('image-input').addEventListener('change', previewImage);

    // Load reflections on page load
    loadReflections();
    setInterval(updateDateTime, 1000);
    updateDateTime();
</script> 
  <script>
    if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(reg => console.log('Service Worker registered', reg))
      .catch(err => console.log('Service Worker registration failed', err));
  });
}

  </script> 
</body>
</html>

